{"id":1325132037,"name":"Test","node_id":"WFR_kwLOA_1uaM5O--kF","head_branch":"docker-build-context","head_sha":"630460a282d6d2d17d69d99a287a098f7a665677","run_number":9886,"event":"pull_request","status":"completed","conclusion":"cancelled","workflow_id":10954,"check_suite_id":4009520682,"check_suite_node_id":"CS_kwDOA_1uaM7u_G4q","url":"https://api.github.com/repos/dhis2/dhis2-core/actions/runs/1325132037","html_url":"https://github.com/dhis2/dhis2-core/actions/runs/1325132037","pull_requests":[],"created_at":"2021-10-10T05:36:18Z","updated_at":"2021-10-10T05:51:19Z","run_attempt":1,"run_started_at":"2021-10-10T05:36:18Z","jobs_url":"https://api.github.com/repos/dhis2/dhis2-core/actions/runs/1325132037/jobs","logs_url":"https://api.github.com/repos/dhis2/dhis2-core/actions/runs/1325132037/logs","check_suite_url":"https://api.github.com/repos/dhis2/dhis2-core/check-suites/4009520682","artifacts_url":"https://api.github.com/repos/dhis2/dhis2-core/actions/runs/1325132037/artifacts","cancel_url":"https://api.github.com/repos/dhis2/dhis2-core/actions/runs/1325132037/cancel","rerun_url":"https://api.github.com/repos/dhis2/dhis2-core/actions/runs/1325132037/rerun","previous_attempt_url":null,"workflow_url":"https://api.github.com/repos/dhis2/dhis2-core/actions/workflows/10954","head_commit":{"id":"630460a282d6d2d17d69d99a287a098f7a665677","tree_id":"099ea48ba3844539f24fc78d208918caaa5b9e61","message":"chore: reduce docker build context\n\nevery time we run 'docker build' the docker client archives all files in\nthe build context and sends them to the daemon. for me these were ~\n4.63GB which probably depends on whether you ran a local maven build\nbefore or not.\n\nthis change reduces docker build context and thus speeds up the docker\nbuild start time but also the entire docker build as 'COPY . .' now only\ncopies what is actually needed for the build. this also impacts docker\ncache invalidation as previously any file that was added/changed would\ninvalidate the 'COPY . .' layer. That means files irrelevant to the\nbuild were causing the maven build to be repeated ~ 7 minutes for me.\n\nanother aspect that might not be relevant in this scenario (as its only\nconcerning the build stage) is security. secure tokens stored in\ngitignored files in this repo can be included in a docker image if not\nexcluded from the docker build context.\n\nHere are some stats with before/after timings/sizes. docker builds were\nrun with buildkit enabled 'DOCKER_BUILDKIT=1 docker build .'\n\ndocker build context load time/size\nbefore:\n => [internal] load build context 20.2s\n => => transferring context: 4.54GB\nafter:\n => [internal] load build context 3.2s\n => => transferring context: 694.77MB 3.1s\n\nCOPY . .\nbefore: 9.1s\nafter: 1.2s\n\nNote that the timings may vary for you and also on every run.\n\nFor more read https://codefresh.io/docker-tutorial/not-ignore-dockerignore-2/","timestamp":"2021-10-10T05:19:04Z","author":{"name":"teleivo","email":"teleivo@users.noreply.github.com"},"committer":{"name":"teleivo","email":"teleivo@users.noreply.github.com"}},"repository":{"id":66940520,"node_id":"MDEwOlJlcG9zaXRvcnk2Njk0MDUyMA==","name":"dhis2-core","full_name":"dhis2/dhis2-core","private":false,"owner":{"login":"dhis2","id":1089987,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEwODk5ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1089987?v=4","gravatar_id":"","url":"https://api.github.com/users/dhis2","html_url":"https://github.com/dhis2","followers_url":"https://api.github.com/users/dhis2/followers","following_url":"https://api.github.com/users/dhis2/following{/other_user}","gists_url":"https://api.github.com/users/dhis2/gists{/gist_id}","starred_url":"https://api.github.com/users/dhis2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dhis2/subscriptions","organizations_url":"https://api.github.com/users/dhis2/orgs","repos_url":"https://api.github.com/users/dhis2/repos","events_url":"https://api.github.com/users/dhis2/events{/privacy}","received_events_url":"https://api.github.com/users/dhis2/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/dhis2/dhis2-core","description":"DHIS2 Core. Written in Java. Contains the service layer and Web API.","fork":false,"url":"https://api.github.com/repos/dhis2/dhis2-core","forks_url":"https://api.github.com/repos/dhis2/dhis2-core/forks","keys_url":"https://api.github.com/repos/dhis2/dhis2-core/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dhis2/dhis2-core/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dhis2/dhis2-core/teams","hooks_url":"https://api.github.com/repos/dhis2/dhis2-core/hooks","issue_events_url":"https://api.github.com/repos/dhis2/dhis2-core/issues/events{/number}","events_url":"https://api.github.com/repos/dhis2/dhis2-core/events","assignees_url":"https://api.github.com/repos/dhis2/dhis2-core/assignees{/user}","branches_url":"https://api.github.com/repos/dhis2/dhis2-core/branches{/branch}","tags_url":"https://api.github.com/repos/dhis2/dhis2-core/tags","blobs_url":"https://api.github.com/repos/dhis2/dhis2-core/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dhis2/dhis2-core/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dhis2/dhis2-core/git/refs{/sha}","trees_url":"https://api.github.com/repos/dhis2/dhis2-core/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dhis2/dhis2-core/statuses/{sha}","languages_url":"https://api.github.com/repos/dhis2/dhis2-core/languages","stargazers_url":"https://api.github.com/repos/dhis2/dhis2-core/stargazers","contributors_url":"https://api.github.com/repos/dhis2/dhis2-core/contributors","subscribers_url":"https://api.github.com/repos/dhis2/dhis2-core/subscribers","subscription_url":"https://api.github.com/repos/dhis2/dhis2-core/subscription","commits_url":"https://api.github.com/repos/dhis2/dhis2-core/commits{/sha}","git_commits_url":"https://api.github.com/repos/dhis2/dhis2-core/git/commits{/sha}","comments_url":"https://api.github.com/repos/dhis2/dhis2-core/comments{/number}","issue_comment_url":"https://api.github.com/repos/dhis2/dhis2-core/issues/comments{/number}","contents_url":"https://api.github.com/repos/dhis2/dhis2-core/contents/{+path}","compare_url":"https://api.github.com/repos/dhis2/dhis2-core/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dhis2/dhis2-core/merges","archive_url":"https://api.github.com/repos/dhis2/dhis2-core/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dhis2/dhis2-core/downloads","issues_url":"https://api.github.com/repos/dhis2/dhis2-core/issues{/number}","pulls_url":"https://api.github.com/repos/dhis2/dhis2-core/pulls{/number}","milestones_url":"https://api.github.com/repos/dhis2/dhis2-core/milestones{/number}","notifications_url":"https://api.github.com/repos/dhis2/dhis2-core/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dhis2/dhis2-core/labels{/name}","releases_url":"https://api.github.com/repos/dhis2/dhis2-core/releases{/id}","deployments_url":"https://api.github.com/repos/dhis2/dhis2-core/deployments"},"head_repository":{"id":412455912,"node_id":"R_kgDOGJWT6A","name":"dhis2-core","full_name":"teleivo/dhis2-core","private":false,"owner":{"login":"teleivo","id":4661144,"node_id":"MDQ6VXNlcjQ2NjExNDQ=","avatar_url":"https://avatars.githubusercontent.com/u/4661144?v=4","gravatar_id":"","url":"https://api.github.com/users/teleivo","html_url":"https://github.com/teleivo","followers_url":"https://api.github.com/users/teleivo/followers","following_url":"https://api.github.com/users/teleivo/following{/other_user}","gists_url":"https://api.github.com/users/teleivo/gists{/gist_id}","starred_url":"https://api.github.com/users/teleivo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/teleivo/subscriptions","organizations_url":"https://api.github.com/users/teleivo/orgs","repos_url":"https://api.github.com/users/teleivo/repos","events_url":"https://api.github.com/users/teleivo/events{/privacy}","received_events_url":"https://api.github.com/users/teleivo/received_events","type":"User","site_admin":false},"html_url":"https://github.com/teleivo/dhis2-core","description":"DHIS2 Core. Written in Java. Contains the service layer and Web API.","fork":true,"url":"https://api.github.com/repos/teleivo/dhis2-core","forks_url":"https://api.github.com/repos/teleivo/dhis2-core/forks","keys_url":"https://api.github.com/repos/teleivo/dhis2-core/keys{/key_id}","collaborators_url":"https://api.github.com/repos/teleivo/dhis2-core/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/teleivo/dhis2-core/teams","hooks_url":"https://api.github.com/repos/teleivo/dhis2-core/hooks","issue_events_url":"https://api.github.com/repos/teleivo/dhis2-core/issues/events{/number}","events_url":"https://api.github.com/repos/teleivo/dhis2-core/events","assignees_url":"https://api.github.com/repos/teleivo/dhis2-core/assignees{/user}","branches_url":"https://api.github.com/repos/teleivo/dhis2-core/branches{/branch}","tags_url":"https://api.github.com/repos/teleivo/dhis2-core/tags","blobs_url":"https://api.github.com/repos/teleivo/dhis2-core/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/teleivo/dhis2-core/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/teleivo/dhis2-core/git/refs{/sha}","trees_url":"https://api.github.com/repos/teleivo/dhis2-core/git/trees{/sha}","statuses_url":"https://api.github.com/repos/teleivo/dhis2-core/statuses/{sha}","languages_url":"https://api.github.com/repos/teleivo/dhis2-core/languages","stargazers_url":"https://api.github.com/repos/teleivo/dhis2-core/stargazers","contributors_url":"https://api.github.com/repos/teleivo/dhis2-core/contributors","subscribers_url":"https://api.github.com/repos/teleivo/dhis2-core/subscribers","subscription_url":"https://api.github.com/repos/teleivo/dhis2-core/subscription","commits_url":"https://api.github.com/repos/teleivo/dhis2-core/commits{/sha}","git_commits_url":"https://api.github.com/repos/teleivo/dhis2-core/git/commits{/sha}","comments_url":"https://api.github.com/repos/teleivo/dhis2-core/comments{/number}","issue_comment_url":"https://api.github.com/repos/teleivo/dhis2-core/issues/comments{/number}","contents_url":"https://api.github.com/repos/teleivo/dhis2-core/contents/{+path}","compare_url":"https://api.github.com/repos/teleivo/dhis2-core/compare/{base}...{head}","merges_url":"https://api.github.com/repos/teleivo/dhis2-core/merges","archive_url":"https://api.github.com/repos/teleivo/dhis2-core/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/teleivo/dhis2-core/downloads","issues_url":"https://api.github.com/repos/teleivo/dhis2-core/issues{/number}","pulls_url":"https://api.github.com/repos/teleivo/dhis2-core/pulls{/number}","milestones_url":"https://api.github.com/repos/teleivo/dhis2-core/milestones{/number}","notifications_url":"https://api.github.com/repos/teleivo/dhis2-core/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/teleivo/dhis2-core/labels{/name}","releases_url":"https://api.github.com/repos/teleivo/dhis2-core/releases{/id}","deployments_url":"https://api.github.com/repos/teleivo/dhis2-core/deployments"}}